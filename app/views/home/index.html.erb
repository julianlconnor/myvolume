<div id="body_container">
	<div id="player_wrapper">
		<div id="player_fixed">
			<audio preload="none"></audio>
			<ol id="player_playlist">
			</ol>
		</div>
	</div>
	<div id="content_wrapper">
		<span>myvolu.me beta v 1.0</span>
		<h1>Welcome to myvolu.me</h1>
		<div id="charts">
			<%= render 'charts' %>
		</div>
	</div>
</div>

<script>

	// Initialize HTML5 <audio>
	$(function() {
		if ($.browser.mozilla) {
			audiojs.createAll();
		}
		else {
			var as = audiojs.createAll();
		}
	});
	
	// Handle audio player scroll thingie
	$(window).scroll(function(e){ 
		$el = $('#player_fixed');
		if ($(this).scrollTop() > 118 && $el.css('position') != 'fixed'){ 
			$('#player_fixed').css({'position': 'fixed', 'top': '15px'}); 
		}
		if ($(this).scrollTop() < 118 && $el.css('position') != 'absolute'){ 
			$('#player_fixed').css({'position': 'relative', 'top': '90px'});
		}
	});
	$(function() { 
	     // Setup the player to autoplay the next track
	     var a = audiojs.createAll({
	     	       trackEnded: function() {
	     	       	     	         var next = $('ol li.playing').next();
	     	       	     	         if (!next.length) next = $('ol li').first();
	     	       	     	         next.addClass('playing').siblings().removeClass('playing');
	     	       	     	         audio.load($('a', next).attr('data-src'));
	     	       	     	         audio.play();
	     	       	     	       }
	     	     });
     
	     // Load in the first track
	     var audio = a[0];
	         first = $('ul a').attr('data-src');
	     //$('ul li').first().addClass('playing');
	     audio.load(first);

		 // Expand a playlist on header click
		$('h1').live('click',function(e) {
			var chart_id = $(this).attr("id");
			$("." + chart_id).slideToggle("slow");
		});

	     // Load in a track on click from right div playlists
	     $('ul li div.play_button').live('click',function(e) {
		   // Copy selected node
		   var clicked_node = $(this).parent().parent().parent().clone();
		   var playing = $(".playing").removeClass('playing');
		
		   // Hide play and queue button during playback
		   // clicked_node.find('.play_button').hide();
		   // clicked_node.find('.queue_button').hide();
		   // Show play and queue button for previously playing track
		   // playing.find('.play_button').show();
		   // playing.find('.queue_button').show();
		   // Load the track into the player
		
	       e.preventDefault();
	       //$(this).addClass('playing').siblings().removeClass('playing');
		   	clicked_node.addClass('playing').addClass('playlist').prependTo($("#player_playlist"));
		   if ( $("#player_playlist li").length > 9 ) {
			$("#player_playlist li:last").remove()
		   }
	       audio.load($('a', clicked_node).attr('data-src'));
	       audio.play();
	     });
	
		// Queue track on playlist, same but append
		$('ul li div.queue_button').live('click', function(e) {
		   var clicked_node = $(this).parent().parent().parent();
		   // Load the track into the player
	       e.preventDefault();
	       //$(this).addClass('playing').siblings().removeClass('playing');
		   clicked_node.clone().appendTo($("#player_playlist"));
		   if ( $("#player_playlist li").length > 9 ) {
			$("#player_playlist li:last").remove()
		   }
	     });
	
		// Load in a track on click from the player playlist
		$('ol li div.play_button').live('click', function(e) {
		   var clicked_node = $(this).parent().parent();
		   // Load the track into the player
	       e.preventDefault();
		   clicked_node
	       clicked_node.addClass('playing').siblings().removeClass('playing');
	       audio.load($('a', clicked_node).attr('data-src'));
	       audio.play();
	     });
	     // Keyboard shortcuts
	     // $(document).keydown(function(e) {
	     //   var unicode = e.charCode ? e.charCode : e.keyCode;
	     //      // right arrow
	     //   if (unicode == 39) {
	     //     var next = $('li.playing').next();
	     //     if (!next.length) next = $('ul li').first();
	     //     next.click();
	     //     // back arrow
	     //   } else if (unicode == 37) {
	     //     var prev = $('li.playing').prev();
	     //     if (!prev.length) prev = $('ul li').last();
	     //     prev.click();
	     //     // spacebar
	     //   } else if (unicode == 32) {
	     //     audio.playPause();
	     //   }
	     // })
	   });
</script>